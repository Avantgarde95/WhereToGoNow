<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="../../../../favicon.ico">

    <title>WhereToGoNow - Login</title>

    <!-- Bootstrap core CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='libs/bootstrap-4.0.0-beta.2.min.css') }}">

    <script type="text/javascript" src="{{ url_for('static', filename='libs/jquery-3.2.1.min.js') }}"></script>

    <!-- Custom styles for this template -->
    <style>
    body {
      padding-top: 40px;
      padding-bottom: 40px;
      background-color: #eee;
    }

    .form-signin {
      max-width: 330px;
      padding: 15px;
      margin: 0 auto;
    }

    .form-signin .form-signin-heading,
    .form-signin .checkbox {
      margin-bottom: 10px;
    }

    .form-signin .checkbox {
      font-weight: 400;
    }

    .form-signin .form-control {
      position: relative;
      box-sizing: border-box;
      height: auto;
      padding: 10px;
      font-size: 16px;
    }

    .form-signin .form-control:focus {
      z-index: 2;
    }

    .form-signin input[type="email"] {
      margin-bottom: -1px;
      border-bottom-right-radius: 0;
      border-bottom-left-radius: 0;
    }

    .form-signin input[type="password"] {
      margin-bottom: 10px;
      border-top-left-radius: 0;
      border-top-right-radius: 0;
    }
    </style>

    <script type="text/javascript">
        function request(type) {
            var url;

            if (type === 'sign-up') {
                url = '/signin/signup';
            } else if (type === 'sign-in') {
                url = '/signin/signin';
            } else {
                return;
            }

            var id = $('#input-id').val();
            var password = $('#input-password').val();

            // check whether id and password are empty
            if (!id || !password || !id.length || !password.length) {
                console.log(type + ' failed: empty id or password)');
                alert(type + ' failed!');
                return;
            }

            // request sign-up / sign-in
            $.ajax({
                type: 'POST',
                url: url,
                data: JSON.stringify({id: id, password: password}),
                success: (data) => {
                    var result = data.result;

                    if (result) {
                        console.log('Sign-in: Success!');

                        // XXX: Redirection should be done by server...
                        //      This is just for testing...
                        window.location = '/';
                    } else {
                        console.log('Sign-in: Failed! (Invalid id or password)');
                        alert(type + ' failed!');
                    }
                },
                contentType: 'application/json',
                dataType: 'json'
            });
        }

        $(document).ready(() => {
            $('#submit-sign-up').click(() => {
                request('sign-up');
            });

            $('#submit-sign-in').click(() => {
                request('sign-in');
            });
        });
    </script>
</head>

<body>

<nav class="navbar navbar-expand navbar-dark bg-dark" style="margin: 0px;">
    <a class="navbar-brand" href="/">WhereToGoNow</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExample02"
            aria-controls="navbarsExample02"
            aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
</nav>

<div class="container">
    <form class="form-signin">
        <h2 class="form-signin-heading">Sign in</h2>
        <label for="input-id" class="sr-only">Id</label>
        <input type="text" id="input-id" class="form-control" placeholder="Id" required autofocus>
        <label for="input-password" class="sr-only">Password</label>
        <input type="password" id="input-password" class="form-control" placeholder="Password"
               required>
        <!--
        <div class="checkbox">
            <label>
                <input type="checkbox" value="remember-me"> Remember me
            </label>
        </div>
        -->
        <button id="submit-sign-up" class="btn btn-md btn-primary btn-block" type="button">
            New user? Sign up!
        </button>
        <button id="submit-sign-in" class="btn btn-md btn-info btn-block" type="button">
            Already have an account? Sign in!
        </button>
    </form>
</div>
<!-- /container -->
</body>

</html>
